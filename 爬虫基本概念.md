# 爬虫基本概念

[TOC]

## 1 字符串知识点复习

### 1-1字符串类型的区别和转化

![image-20210226100610135](%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226100610135.png)

```Python
b.decode("gbk")//报错不行，或者出现乱码，因为编码解码方式必须一致
```

## 2 http和HTTPS的概念

- HTTP
  - 超文本传输协议
  - 默认端口号：80
- HTTPS
  - HTTP+SSL(安全套接字层)
  - 默认端口号：443

> HTTPS比HTTP更安全，但是性能更低

双方约定好把数据放在哪一行，另一方去找就是协议

HTTP明文传输，不安全，别人有工具就能知道传输内容

加密+解密——HTTPS——多了这两个过程

```
.com:443
.com:80
```

## 3 Markdown介绍

> 爬虫是模拟浏览器发送请求，获取响应

爬虫的流程：

- url——发送请求，获取响应——提取数据——保存
- 发送请求，获取响应——提取url

```python
import json
t=json.loads("{}")
```

```json
{
    "a":"c",
    "c":"f"
}
```

## 4 URL格式和HTTP请求格式

### 4-1 url的形式

形式

scheme://host[:port#]/path/.../[?query-string] [#anchor]

- ?后面——是参数，很长但是没什么用，删掉也一样
- anchor——锚 跳转到网页的指定锚点位置
- path——路径 相对目录

> 带锚点和不带锚点的响应~~位置是不一样的~~——看看有没有重新发送请求就知道了
>
> 结果是一样的

### 4-2 HTTP请求形式

![image-20210226103058545](%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226103058545.png)

![image-20210226103154990](%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226103154990.png)

GET那行——请求方法 协议版本

HOST：头部字段名+值

请求体（只有POST请求才有请求体否则没有）

Connection：浏览器告诉我们支持使用长链接**keep-alive**想要复用上次链接

> why？耗时更短，速率更快，不用多次挥手请求

User-Agent:内核版本（电脑信息）浏览器的内核版本（版本号）

> 可以用来模仿任何版本的浏览器（手机信息）——User-Agent字段
>
> 可以修改来模拟其他版本的网页

Upgrade-Insecure-Requests: 1

> 升级不安全的请求——支持转化成安全请求HTTP——>HTTPS

Accept：可以接受什么数据

Accept-Encoding: 页面编码形式

Accept-Language:可以接受的语言；q是权重其次是什么数据

Cookie：参数

> 用来保存用户个人信息，对方希望保存在本地的信息
>
> 和session的区别：
>
> 1. 保存在浏览器本地：不安全，有上限，设置几个G的cookie，不能多
> 2. session保存在对方浏览器上面，更安全，没有上限，服务器足够大，想存多少存多少

![image-20210226104612867](%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226104612867.png)

> **使用分号加空格隔开** 只有Name和Value对应的值，其他内容不用关注
>
> User-Agent可能还不够，模仿浏览器，还要全部字段带上没必要
>
> 除了User-Agent偶尔带上cookie就够了

x-requested-with:XMLHttpRequest(是Ajax异步请求)

不带cookie的话，对方服务器很容易发现我们是爬虫，带了cookie的字段是错的，也很容易检查出来，抛出假数据，抛出错误，反反爬虫

**请求数据只有POST请求有**

### 4-3 常见的请求方法

Get和POST

- 字段，或者**携带数据量大**的时候，传输图片 往往用POST请求，**表单提交**的时候用POST请求

### 4-4 响应状态码

- 200 成功
- 302 临时转移至新的url
- 307 临时转移至新的url
- 404 not found
- 500 服务器内部错误 或者受到了反爬虫

> 常见的20个Linux命令（面试可能会考）

浏览器渲染出的页面和爬虫请求的页面并不一样

## 5 爬虫的流程

### 5-1 分类

- 通用爬虫：通常指搜索引擎的爬虫
- 聚焦爬虫：针对特定网站的爬虫

<img src="%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226165740336.png" alt="image-20210226165740336" style="zoom:67%;" />

下一页的地方——就要提取url

数据不够——内容没有——获取新闻所有数据就要新闻的所有url，才能拿到当前页面的而所有数据

不光是下一页的url地址，还可能是详情的url地址

## 6 爬虫课程的介绍和概念

<img src="%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226165816275.png" alt="image-20210226165816275" style="zoom:67%;" />

### 6-1 requests的使用

#### 6-1-1 应用场景

大数据时代，我们的数据从哪来

百度为啥有新闻网站呢？都从哪来，从CCTV从人民网从中国新闻网等等

怎么收集过来的，每天更新，爬虫（——靠百度的搜索引擎）

没有播放列表也没有歌，还得是大家品味创建推荐的列表音乐，然后呈现

**将自己爬到的内容呈现在自己的APP里面**

数据分析+数据展示

#### 6-1-2 爬虫的定义

网络爬虫（网络蜘蛛，网络机器人）**模拟客户端发送请求，接受请求响应**

一种按照一定的**规则**，**自动**抓取互联网信息的**程序**

只要浏览器能做的，爬虫就可以，原则上

没办法爬到真实假的，浏览器看到的啥就能看到啥，就能爬到啥

#### 6-1-3 爬虫的更多用途

- 12306抢票
- 网站上的投票
- 短信轰炸

## 7 搜索引擎的工作原理

<img src="%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226165740336.png" alt="image-20210226165740336" style="zoom:67%;" />

种子url是互联网上**所有的url地址**吗？

不是，因为没有必要，种子url也不可能被你们知道，核心价值所在

会出现另一个百度

**预处理**——数据清洗，将重要内容拿出来——

然后分词——why——每个词语都能和当前页面建立联系，方便搜索关键字

排名——点击次数&倍赢次数PageRank

##### 搜索引擎的局限性

- 通用搜索引擎所返回的网页里90%的内容无用
- 图片、音频、视频多媒体的内容通用搜索引擎无能为力
- 不同用户搜索的目的不完全相同，但是返回内容相同 

##### ROBOTS协议

> 道德层面的约束

网站通过此协议告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取 

## 8 浏览器发送请求的流程

<img src="%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226165740336.png" alt="image-20210226165740336" style="zoom:67%;" />

![image-20210226190148275](%E7%88%AC%E8%99%AB%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/image-20210226190148275.png)

> **浏览器渲染出来的页面——js会动态修改动态加载页面的内容**
>
> **爬虫的——只有当前url地址对应的响应的内容**

element内容会通过js调整文本，

Response里面可能是没有数据的，后来Ajax拿到数据才有

##### url的响应和当前url地址的element内容不一样

> JS会调整网页内容

爬虫不会主动请求js，ajax，请求图片——仅仅是字符串，不会执行js的内容

> 提取数据——要根据**当前url地址**对应的响应response来写

如果没有，说明可能在其他url网址里面，也有可能是js来实现的

##### 那么页面上的数据在哪里？

- 当前url地址对应的响应中
- 其他url地址对应的响应中
  - 比如ajax请求中
- JS生成的
  - 部分数据在响应中
  - 全部通过js生成

参数不一定有意义——有些通过js生成的

不要的删掉也可以请求成功